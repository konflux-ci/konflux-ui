name: PR Report to Slack

on:
  workflow_dispatch:

  schedule:
    # Monday, Wednesday, Friday at 2:00 AM UTC
    # Beijing: 10:00 AM | India: 7:30 AM | Brno: 3-4 AM | USA East: 9-10 PM (prev day)
    - cron: '0 2 * * 1,3,5'

jobs:
  check-stale-prs:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install dependencies
      run: npm install @octokit/rest dayjs

    - name: Run stale PR checker
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
      run: node .github/scripts/check-stale-prs.js
